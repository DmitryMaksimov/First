{"version":3,"sources":["Items/date_picker/date_picker.js"],"names":["date_picker__value_from","date_picker__value_to","date_picker__last_move","date_picker_drag","date_picker__drag_start","date_picker__compareDate","v1","v2","getFullYear","getMonth","getDate","date_picker__onmouseup","event","date_picker__onmousedown","parentElement","selection_from","selection_to","single_selection","value","date_picker__onmouseover","date_picker__fillMonth","date_picker__onmouseleave","date_picker__onclick","date_picker__onmousedown_document","e","document","elementFromPoint","clientX","clientY","className","indexOf","arr","querySelectorAll","i","length","style","visibility","date_picker__onresize","element","attributes","left","offsetLeft","clientWidth","top","offsetTop","clientHeight","window","today","Date","current_month","sel_from","sel_to","one_day_start_end","month","weekday","getDay","days","lastdays","querySelector","innerText","String","Intl","DateTimeFormat","format","toString","table","day","row","childNodes","j","cell","current","date_picker__onnext_month","elem","newDate","date_picker__onprev_month","date_picker__update_caption","caption","from","year","to","date_picker__accept","button","popup","onchange","getBoundingClientRect","setTimeout","date_picker_filter__selected_from","date_picker_filter__selected_to","addEventListener","isNaN","getTime","k","alert"],"mappings":"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","file":"date_picker.e7708123.js","sourceRoot":"..","sourcesContent":["var date_picker__value_from = null;\r\nvar date_picker__value_to = null;\r\nvar date_picker__last_move = 0;\r\nvar date_picker_drag = null;\r\nvar date_picker__drag_start = null;\r\n\r\nfunction date_picker__compareDate(v1, v2) {\r\n  if((v1 == null) && (v2 == null))\r\n    return 0;\r\n  if(v1 == null)\r\n    return -1;\r\n  if(v2 == null)\r\n    return 1;\r\n\r\n  if(v1.getFullYear() < v2.getFullYear())\r\n    return -1;\r\n  if(v1.getFullYear() > v2.getFullYear())\r\n    return 1;\r\n  if(v1.getMonth() < v2.getMonth())\r\n    return -1;\r\n  if(v1.getMonth() > v2.getMonth())\r\n    return 1;\r\n  if(v1.getDate() < v2.getDate())\r\n    return -1;\r\n  if(v1.getDate() > v2.getDate())\r\n    return 1;\r\n  return 0;\r\n}\r\n\r\nwindow.date_picker__fillMonth = function (element) {\r\n  var today = new Date();\r\n  var value = element.current_month;\r\n  var sel_from = element.selection_from;\r\n  var sel_to = element.selection_to;\r\n\r\n  var one_day_start_end = date_picker__compareDate(sel_from, sel_to) == 0;\r\n\r\n  var month = new Date(value.getFullYear(), value.getMonth(), 1);\r\n  var weekday = month.getDay();\r\n  if(weekday == 0)\r\n    weekday = 7;\r\n  weekday --;\r\n  if(!weekday)\r\n    weekday = 7;\r\n\r\n  month = new Date(value.getFullYear(), value.getMonth() + 1, 0);\r\n  var days = month.getDate() - 1;\r\n  month = new Date(value.getFullYear(), value.getMonth(), 0);\r\n  var lastdays = month.getDate();\r\n\r\n  element.querySelector(\".date_picker__popup_month_title\").innerText = String(new Intl.DateTimeFormat('ru', { month: 'long'}).format(value)).toString() + ' ' + value.getFullYear();\r\n  var table = element.querySelector(\".date_picker__month_table\");\r\n\r\n  var day = lastdays - weekday; //Заполняем first row остатками предыдущего месяца высчитав первый day\r\n\r\n  var className = \"date_picker__outer\";\r\n\r\n  for( var i=1; i<7; i++ ) { //Перебираем строки Начиная со второй\r\n    var row = table.childNodes[i]; \r\n\r\n    for( var j=0; j<7; j++) { //Перебираем ячейки\r\n      var cell = row.childNodes[j];\r\n\r\n      if(weekday == 0)// После того как кончились дни предыдущего месяца\r\n        day = 0;//Сбрасываем дни (один прибавим чуть ниже), счетчика дней (возрастает)\r\n      if(days == 0) //нерасфасованное количество дней в текущем месяце. Убавляем на единицу\r\n        day = 1; //Инкрементальный счетчик текущего значения для дня\r\n      else\r\n        day ++; //\r\n      \r\n      cell.childNodes[0].childNodes[0].innerText = day;\r\n\r\n      var current = null;\r\n      if(weekday>0)\r\n        current = new Date(value.getFullYear(), value.getMonth()-1, day);\r\n      else\r\n        if(days>0) {\r\n          current = new Date(value.getFullYear(), value.getMonth(), day);\r\n          className = \"date_picker__cell\";\r\n        } else {\r\n          current = new Date(value.getFullYear(), value.getMonth()+1, day);\r\n          className = \"date_picker__outer\";\r\n        }\r\n\r\n      cell.value = current;\r\n      cell.className = \"date_picker__cell\";\r\n      cell.childNodes[0].className = \"date_picker__cell\";\r\n      cell.childNodes[0].childNodes[0].className = className;\r\n      \r\n\r\n      if(date_picker__compareDate(current, today) == 0) { //Если это сегодняшний день, отмечаем\r\n        cell.className = \"date_picker__today\";\r\n      }\r\n\r\n      if(one_day_start_end) { //День начала совпадает с окончанием\r\n        if(date_picker__compareDate(current, sel_from) == 0) {\r\n          cell.className = \"date_picker__select\";\r\n        }\r\n      } else {\r\n        if(date_picker__compareDate(sel_from, current) == 0) {\r\n          cell.className = \"date_picker__select\";\r\n          cell.childNodes[0].className = \"date_picker__fill_start\";\r\n        } else\r\n        if(date_picker__compareDate(sel_to, current) == 0) {\r\n          cell.className = \"date_picker__select\";\r\n          cell.childNodes[0].className = \"date_picker__fill_end\";\r\n        } else\r\n        if((date_picker__compareDate(sel_from, current) < 0) && (date_picker__compareDate(current, sel_to) < 0)) {\r\n          cell.childNodes[0].className = \"date_picker__fill\";\r\n        }\r\n      }\r\n\r\n      if(weekday < 0)\r\n        days --;\r\n      weekday --;\r\n    }\r\n  }\r\n}\r\n\r\nfunction date_picker__onmouseup(event) {\r\n  date_picker_drag = null;\r\n}\r\n\r\nfunction date_picker__onmousedown(event) {\r\n  date_picker_drag = this.parentElement.parentElement.parentElement.parentElement;\r\n  date_picker__value_from = date_picker_drag.selection_from;\r\n  date_picker__value_to = date_picker_drag.selection_to;\r\n\r\n  if(date_picker_drag.single_selection) {\r\n    date_picker__drag_start = this.value;\r\n    return;\r\n  }\r\n\r\n  if(date_picker__compareDate(this.value, date_picker_drag.selection_from) == 0) {\r\n    date_picker__drag_start = date_picker_drag.selection_to;\r\n  } else if(date_picker__compareDate(this.value, date_picker_drag.selection_to) == 0) {\r\n    date_picker__drag_start = date_picker_drag.selection_from;\r\n  } else {\r\n    date_picker__drag_start = this.value;\r\n  }\r\n}\r\n\r\nfunction date_picker__onmouseover(event) {\r\n  if(date_picker_drag == null)\r\n    return;\r\n  if((date_picker__compareDate(this.value, date_picker__drag_start) == 0) ||\r\n  date_picker_drag.single_selection) {\r\n    date_picker_drag.selection_from = this.value;\r\n    date_picker_drag.selection_to = this.value;\r\n    date_picker__fillMonth(date_picker_drag);\r\n    return;\r\n  }\r\n  if(this.value < date_picker__drag_start) {\r\n    date_picker_drag.selection_from = this.value;\r\n    date_picker_drag.selection_to = date_picker__drag_start;\r\n    date_picker__fillMonth(date_picker_drag);\r\n    date_picker__last_move = -1;\r\n    return;\r\n  }\r\n  date_picker_drag.selection_from = date_picker__drag_start;\r\n  date_picker_drag.selection_to = this.value;\r\n  date_picker__fillMonth(date_picker_drag);\r\n  date_picker__last_move = 1;\r\n}\r\n\r\nfunction date_picker__onmouseleave(event) {\r\n  if(date_picker_drag == null)\r\n    return;\r\n  date_picker_drag.selection_from = date_picker__value_from;\r\n  date_picker_drag.selection_to = date_picker__value_to;\r\n  date_picker__fillMonth(date_picker_drag);\r\n  date_picker_drag = null;\r\n}\r\n\r\nfunction date_picker__onclick(event) {\r\n  var date_picker_drag = this.parentElement.parentElement.parentElement.parentElement;\r\n\r\n  if((date_picker_drag.selection_from == null) ||\r\n  (date_picker_drag.selection_to == null) ||\r\n  date_picker_drag.single_selection) {\r\n    date_picker_drag.selection_from = date_picker_drag.selection_to = this.value;\r\n    date_picker__fillMonth(date_picker_drag);\r\n    return;\r\n  }\r\n\r\n  if(this.value < date_picker_drag.selection_from) {\r\n    date_picker_drag.selection_from = this.value;\r\n    date_picker__fillMonth(date_picker_drag);\r\n    date_picker__last_move = -1;\r\n    return;\r\n  }\r\n\r\n  if(date_picker_drag.selection_to < this.value) {\r\n    date_picker_drag.selection_to = this.value;\r\n    date_picker__fillMonth(date_picker_drag);\r\n    date_picker__last_move = 1;\r\n    return;\r\n  }\r\n\r\n  if(date_picker__last_move == 0)\r\n    return;\r\n\r\n  if(date_picker__last_move < 0)\r\n    date_picker_drag.selection_from = this.value;\r\n  else\r\n    date_picker_drag.selection_to = this.value;\r\n  date_picker__fillMonth(date_picker_drag);\r\n}\r\n\r\nwindow.date_picker__onnext_month = function (elem) {\r\n  var element = elem.parentElement.parentElement.parentElement;\r\n  var current = element.current_month;\r\n  var newDate = new Date(current.getFullYear(), current.getMonth() + 1, current.getDate());\r\n  element.current_month = newDate;\r\n  date_picker__fillMonth(element);\r\n}\r\n\r\nwindow.date_picker__onprev_month = function date_picker__onprev_month(elem) {\r\n  var element = elem.parentElement.parentElement.parentElement;\r\n  var current = element.current_month;\r\n  var newDate = new Date(current.getFullYear(), current.getMonth() - 1, current.getDate());\r\n  element.current_month = newDate;\r\n  date_picker__fillMonth(element);\r\n}\r\n\r\n/* auto close */\r\nfunction date_picker__onmousedown_document(event) {\r\n  try {\r\n    var e = document.elementFromPoint(event.clientX, event.clientY);\r\n    while(e) {\r\n      if(e.className.indexOf('date_picker__popup_container') >= 0)\r\n        return;\r\n      e = e.parentElement;\r\n    }\r\n  } catch(e) {\r\n    return;\r\n  }\r\n  var arr = document.querySelectorAll('.date_picker__popup_container');\r\n  for( var i=0; i<arr.length; i++)\r\n    arr[i].style.visibility = 'hidden';\r\n}\r\n\r\nwindow.date_picker__update_caption = function(element) {\r\n  var caption = element.querySelector('.date_picker__caption');\r\n  if((element.selection_from == null) || (element.selection_to == null)) {\r\n    caption.innerText = \"\";\r\n    return;\r\n  }\r\n\r\n  if(element.single_selection) {\r\n    var from = new Intl.DateTimeFormat('ru', { day: '2-digit', month: '2-digit', year: 'numeric'}).format(element.selection_from);\r\n    caption.innerText = from.toString();\r\n  } else {\r\n    var from = new Intl.DateTimeFormat('ru', { day: 'numeric', month: 'short' }).format(element.selection_from);\r\n    var to = new Intl.DateTimeFormat('ru', { day: 'numeric', month: 'short' }).format(element.selection_to);\r\n    caption.innerText = from.toString() + ' - ' + to.toString();\r\n  }\r\n}\r\n\r\nwindow.date_picker__accept = function (button) {\r\n  var element = button.parentElement.parentElement.parentElement;\r\n  var popup = element.querySelector('.date_picker__popup_container');\r\n  date_picker__update_caption(element);\r\n  popup.style.visibility = 'hidden';\r\n  try {\r\n    element.onchange(element);\r\n  } catch(e) {\r\n\r\n  }\r\n}\r\n\r\nwindow.date_picker__onmousedown = function(elem) {\r\n  element = elem.parentElement;\r\n  var popup = element.querySelector('.date_picker__popup_container');\r\n  var rect = element.getBoundingClientRect();\r\n\r\n  if(element.attributes['right_justifyed'] != null) {\r\n    popup.style.left = (element.offsetLeft + element.clientWidth - popup.clientWidth) + 'px';\r\n  } else {\r\n    popup.style.left = element.offsetLeft + 'px';\r\n  }\r\n  popup.style.top = element.offsetTop + element.clientHeight + 'px';\r\n\r\n  if(popup.style.visibility != 'visible')\r\n    window.setTimeout(function() {popup.style.visibility = 'visible';}, 100)\r\n  return false;\r\n}\r\n\r\n\r\nfunction date_picker__onresize() {\r\n  arr = document.querySelectorAll('.date_picker__popup_container');\r\n  for(var i=0; i<arr.length; i++) {\r\n    if(arr[i].style.visibility != 'visible')\r\n      continue;\r\n\r\n    \r\n\r\n    element = arr[i].parentElement;\r\n    if(element.attributes['right_justifyed'] != null) {\r\n      arr[i].style.left = (element.offsetLeft + element.clientWidth - arr[i].clientWidth) + 'px';\r\n    } else {\r\n      arr[i].style.left = element.offsetLeft + 'px';\r\n    }\r\n    arr[i].style.top = element.offsetTop + element.clientHeight + 'px';\r\n  }\r\n}\r\n\r\nwindow.date_picker_filter__selected_from = function (element) {\r\n  element.parentElement.selection_from = element.selection_from;\r\n  try {\r\n    element.parentElement.onchange(element.parentElement);\r\n  } catch(e) {\r\n\r\n  }\r\n}\r\n\r\nwindow.date_picker_filter__selected_to = function (element) {\r\n  element.parentElement.selection_to = element.selection_from;\r\n  try {\r\n    element.parentElement.onchange(element.parentElement);\r\n  } catch(e) {\r\n\r\n  }\r\n}\r\n\r\nwindow.addEventListener('load', function () {\r\n  var arr = document.querySelectorAll(\".date_picker__container\");\r\n  for(var i=0; i<arr.length; i++) {\r\n\r\n    var table = arr[i].querySelector(\".date_picker__month_table\");\r\n\r\n    arr[i].single_selection = arr[i].attributes.single_selection != null;\r\n    arr[i].selection_from = arr[i].attributes.selection_from;\r\n    arr[i].selection_to = arr[i].attributes.selection_to;\r\n\r\n    arr[i].addEventListener(\"mouseleave\", date_picker__onmouseleave);\r\n\r\n    var from = new Date(arr[i].selection_from);\r\n    if(isNaN(from.getTime())) {\r\n      arr[i].current_month = new Date();\r\n      arr[i].selection_from = null;\r\n      arr[i].selection_to = null;\r\n    } else {\r\n      var to = new Date(arr[i].selection_to);\r\n      if(isNaN(to.getTime())) {\r\n        arr[i].current_month = new Date();\r\n        arr[i].selection_from = null;\r\n        arr[i].selection_to = null;\r\n      } else {\r\n        arr[i].selection_from = from;\r\n        arr[i].selection_to = to;\r\n        arr[i].current_month = from;\r\n      }\r\n    }\r\n\r\n    date_picker__update_caption(arr[i]);\r\n\r\n    for( var j=1; j<7; j++ ) { //Перебираем строки Начиная со второй\r\n      var row = table.childNodes[j]; \r\n      for( var k=0; k<7; k++) { //Перебираем ячейки\r\n        var cell = row.childNodes[k];\r\n        cell.addEventListener(\"click\", date_picker__onclick);\r\n        cell.addEventListener(\"dragstart\", function() {alert();return false;});\r\n        cell.addEventListener(\"mousedown\", date_picker__onmousedown);\r\n        cell.addEventListener(\"mouseover\", date_picker__onmouseover);\r\n      }\r\n    }  \r\n    date_picker__fillMonth(arr[i]);\r\n  }\r\n  document.addEventListener(\"mouseup\", date_picker__onmouseup);\r\n  document.addEventListener(\"mousedown\", date_picker__onmousedown_document);\r\n  window.addEventListener('resize', date_picker__onresize);\r\n});"]}