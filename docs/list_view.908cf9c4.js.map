{"version":3,"sources":["Items/list_view/list_view.js"],"names":["list_view__declOfNum","n","titles","list_view__onmousedown_document","event","e","document","elementFromPoint","clientX","clientY","className","indexOf","parentElement","arr","querySelectorAll","i","length","style","visibility","list_view__onresize","element","left","offsetLeft","top","offsetTop","clientHeight","width","offsetWidth","window","list_view__button_add","row","input","querySelector","value","isNaN","list_view__onrowchange","list_view__button_sub","list_view__update_caption","caption","total","captionText","values","decls","append","JSON","parse","attributes","tagName","toUpperCase","innerText","list_view__accept","list","val","parseInt","childNodes","list_view__clear","list_view__show_popup","elem","popup","getBoundingClientRect","setTimeout","classList","add","remove","addEventListener","toString","Array","names","rows","j"],"mappings":"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","file":"list_view.908cf9c4.js","sourceRoot":"..","sourcesContent":["/* Склонение declOfNum(count, ['найдена', 'найдено', 'найдены']); */\r\nfunction list_view__declOfNum(n, titles) {\r\n  return titles[(n % 10 === 1 && n % 100 !== 11) ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2];\r\n}\r\n\r\n/* auto close */\r\nfunction list_view__onmousedown_document(event) {\r\n  try {\r\n    var e = document.elementFromPoint(event.clientX, event.clientY);\r\n    while(e) {\r\n      if(e.className.indexOf('list_view__popup_container') >= 0)\r\n        return;\r\n      e = e.parentElement;\r\n    }\r\n  } catch(e) {\r\n    return;\r\n  }\r\n  var arr = document.querySelectorAll('.list_view__popup_container');\r\n  for( var i=0; i<arr.length; i++)\r\n    arr[i].style.visibility = 'hidden';\r\n}\r\n\r\nwindow.list_view__button_add = function (row) {\r\n  var input = row.querySelector(\".list_view__editor\");\r\n  var value = input.value;\r\n  if(isNaN(value))\r\n    value = 1;\r\n  else\r\n    value ++;\r\n  input.value = value;\r\n  list_view__onrowchange(row);\r\n}\r\n\r\nwindow.list_view__button_sub = function (row) {\r\n  var input = row.querySelector(\".list_view__editor\");\r\n  var value = input.value;\r\n  if(isNaN(value) || value <= 0)\r\n    value = 0;\r\n  else\r\n    value --;\r\n  input.value = value;\r\n  list_view__onrowchange(row);\r\n}\r\n\r\nwindow.list_view__update_caption = function(element) {\r\n  var caption = element.querySelector('.list_view__caption');\r\n  var total = 0;\r\n  var captionText = \"\";\r\n\r\n  for(var i=0; i<element.values.length; i++) {\r\n    if(element.decls[i].length > 0) {\r\n      if(element.values[i] <= 0)\r\n        continue;\r\n      var append = element.values[i] + \" \" + list_view__declOfNum(element.values[i], element.decls[i]);\r\n\r\n      if(captionText == \"\")\r\n        captionText = append;\r\n      else\r\n        captionText += \", \" + append;\r\n    } else\r\n      total += element.values[i];\r\n  }\r\n  if(total > 0) {\r\n    if(captionText == \"\")\r\n      captionText = total + \" \" + list_view__declOfNum(total, JSON.parse(element.attributes['other_decls'].value));\r\n    else\r\n      captionText = total + \" \" + list_view__declOfNum(total, JSON.parse(element.attributes['other_decls'].value)) + \", \" + captionText;\r\n  }\r\n\r\n  if(caption.tagName.toUpperCase() == 'INPUT') {\r\n    if(captionText == \"\")\r\n      caption.value = element.caption;\r\n    else\r\n      caption.value = captionText;\r\n  } else {\r\n    if(captionText == \"\")\r\n      caption.innerText = element.caption;\r\n    else\r\n      caption.innerText = captionText;\r\n \r\n  }\r\n  return;  \r\n}\r\n\r\nwindow.list_view__accept = function(element) {\r\n  var list = element;\r\n  element = element.parentElement;\r\n  for(var i=0; i<element.values.length; i++) {\r\n    val = parseInt(list.childNodes[i].querySelector('.list_view__editor').value);\r\n    if(isNaN(val) || val < 0)\r\n      val = 0;\r\n    element.values[i] = val;\r\n  }\r\n  list_view__update_caption(element);\r\n  element.querySelector('.list_view__popup_container').style.visibility = 'hidden';\r\n}\r\n\r\nwindow.list_view__clear = function(element) {\r\n  var arr = element.querySelectorAll('.list_view__editor');\r\n  for(var i=0; i<arr.length; i++) {\r\n    arr[i].value = 0;\r\n  }\r\n}\r\n\r\nwindow.list_view__show_popup = function(elem) {\r\n  element = elem.parentElement;\r\n  var popup = element.querySelector('.list_view__popup_container');\r\n  var rect = element.getBoundingClientRect();\r\n  popup.style.left = element.offsetLeft + 'px';\r\n  popup.style.top = element.offsetTop + element.clientHeight + 'px';\r\n  popup.style.width = element.offsetWidth + 'px';\r\n\r\n  \r\n  var arr = popup.querySelectorAll('.list_view__editor');\r\n  for(var i = 0; i<element.values.length; i++) {\r\n    arr[i].value = element.values[i];\r\n    list_view__onrowchange(arr[i].parentElement);\r\n  }\r\n\r\n  if(popup.style.visibility != 'visible')\r\n    window.setTimeout(function() {popup.style.visibility = 'visible';}, 100)\r\n  return false;\r\n}\r\n\r\nfunction list_view__onresize() {\r\n  arr = document.querySelectorAll('.list_view__popup_container');\r\n  for(var i=0; i<arr.length; i++) {\r\n    if(arr[i].style.visibility != 'visible')\r\n      continue;\r\n\r\n    element = arr[i].parentElement;\r\n    arr[i].style.left = element.offsetLeft + 'px';\r\n    arr[i].style.top = element.offsetTop + element.clientHeight + 'px';\r\n    arr[i].style.width = element.offsetWidth + 'px';\r\n  }\r\n}\r\n\r\nwindow.list_view__onrowchange = function(row) {\r\n  var input = row.querySelector(\".list_view__editor\");\r\n  var val = parseInt(input.value);\r\n\r\n  if(isNaN(val))\r\n    return;\r\n\r\n  if(val <= 0)\r\n    row.querySelector(\".list_view__sub_button\").classList.add('list_view__sub_button_disabled');\r\n  else\r\n    row.querySelector(\".list_view__sub_button\").classList.remove('list_view__sub_button_disabled');\r\n}\r\n\r\nwindow.addEventListener('load', function () {\r\n  var arr = document.querySelectorAll(\".list_view__container\");\r\n  for(var i=0; i<arr.length; i++) {\r\n    arr[i].caption = arr[i].attributes['caption'].value.toString();\r\n    arr[i].values = new Array();\r\n    arr[i].names = new Array();\r\n    arr[i].decls = new Array();\r\n    var rows = arr[i].querySelectorAll('.list_view__row');\r\n    for(var j=0; j<rows.length; j++) {\r\n      var val = [];\r\n      if(rows[j].attributes['names'] != null)\r\n        val = JSON.parse(rows[j].attributes['names'].value)\r\n      arr[i].decls[arr[i].decls.length] = rows[j].names = val;\r\n      val = rows[j].value;\r\n      if(isNaN(val))\r\n        val = 0;\r\n      arr[i].values[arr[i].values.length] = val;\r\n      arr[i].names[arr[i].names.length] = rows[j].attributes['name'].value;\r\n    }\r\n    list_view__update_caption(arr[i]);\r\n\r\n  }\r\n  document.addEventListener(\"mousedown\", list_view__onmousedown_document);\r\n  window.addEventListener('resize', list_view__onresize);\r\n\r\n});"]}